<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CCDB Tutorial</title>

    <!-- GitHub Markdown CSS -->
    <link rel="stylesheet" href="css/github-markdown.css">

    <!-- Highlight.js Theme Link -->
    <link id="hljs-theme-link" rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <style>
        html {
            scroll-behavior: smooth;
            /* For smoother anchor link jumps */
        }

        /* Basic page setup */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            background-color: #f6f8fa;
            /* Default light page background */
            color: #24292f;
            transition: background-color 0.3s, color 0.3s;
            padding: 2rem;
            /* Overall page padding */
            box-sizing: border-box;
            /* Padding included in body's dimensions */
            min-height: 100vh;
            /* Ensure body fills viewport height */
        }

        .page-layout-container {
            display: flex;
            gap: 2rem;
            /* Space between menu and content-wrapper */
            /* Max width: menu (240px) + gap (2rem, e.g., 32px) + markdown-body (980px) */
            max-width: calc(240px + 2rem + 980px);
            width: 100%;
            /* Occupy available width within body's padding */
            margin: 0 auto;
            /* Center this container within the body */
        }

        #side-menu {
            width: 240px;
            /* Width of the side menu */
            flex-shrink: 0;
            /* Prevent menu from shrinking */
            position: sticky;
            /* Stick to top of body's content box (which is 2rem from viewport top due to body padding) */
            top: 0;
            /* Fill height between body's top/bottom padding */
            height: calc(100vh - 4rem);
            overflow-y: auto;
            /* Scroll for long menus */
            background-color: transparent;
            /* Menu bg blends with body */
            padding: 0.5rem;
            /* Internal padding for menu items */
            font-size: 0.875em;
            /* Slightly smaller font for menu */
        }

        #side-menu h2 {
            /* "Contents" heading */
            margin-top: 0;
            margin-bottom: 0.75em;
            font-size: 0.95em;
            font-weight: 600;
            padding-bottom: 0.5em;
            border-bottom: 1px solid #d0d7de;
            /* Light mode separator */
            color: #24292f;
        }

        #side-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #side-menu li a {
            display: block;
            padding: 0.4em 0.8em;
            text-decoration: none;
            color: #57606a;
            border-radius: 4px;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out, font-weight 0.2s ease-in-out;
        }

        #side-menu li a:hover {
            background-color: #f0f3f6;
            color: #0969da;
        }

        #side-menu li.toc-level-1 a {
            padding-left: 0.8em;
            font-weight: 500;
        }

        #side-menu li.toc-level-2 a {
            padding-left: 1.8em;
        }

        #side-menu li.toc-level-3 a {
            padding-left: 2.8em;
        }

        #side-menu li a.active {
            font-weight: 600;
            color: #0969da;
        }

        .content-wrapper {
            flex-grow: 1;
            /* Takes up space allocated by page-layout-container's max-width logic */
            display: flex;
            /* Can be useful if content-wrapper needs internal flex, not strictly needed here */
            /* justify-content: flex-start; /* markdown-body will fill it anyway */
            min-width: 0;
            /* Crucial for flex items */
        }

        .markdown-body {
            min-width: 0;
            max-width: 980px;
            /* This is the primary content width constraint */
            width: 100%;
            /* Takes full width of its parent (content-wrapper) */
            background: white;
            padding: 2em;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Dark mode styles */
        body.dark-mode {
            background-color: #0d1117;
            color: #c9d1d9;
        }

        body.dark-mode #side-menu h2 {
            border-bottom-color: #30363d;
            color: #c9d1d9;
        }

        body.dark-mode #side-menu li a {
            color: #7d8590;
        }

        body.dark-mode #side-menu li a:hover {
            background-color: #1c2128;
            color: #58a6ff;
        }

        body.dark-mode #side-menu li a.active {
            font-weight: 600;
            color: #58a6ff;
        }

        body.dark-mode .markdown-body {
            background-color: #161b22;
            color: #c9d1d9;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .markdown-body blockquote {
            color: #adbac7;
            /* Text color for blockquotes in dark mode */
            border-left-color: #484f58;
            /* Border color for blockquotes in dark mode */
        }

        body.dark-mode .markdown-body a {
            color: #58a6ff;
        }

        body.dark-mode .markdown-body code,
        body.dark-mode .markdown-body pre {
            background-color: #21262d;
        }

        /* Theme toggle switch */
        .theme-switch {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
            width: 50px;
            height: 26px;
            background-color: #ccc;
            border-radius: 999px;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 3px;
            transition: background-color 0.3s;
        }

        .theme-switch .slider {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: transform 0.3s, background-color 0.3s;
        }

        .theme-switch .slider::before {
            content: "‚òÄÔ∏è";
        }

        body.dark-mode .theme-switch {
            background-color: #666;
        }

        body.dark-mode .theme-switch .slider {
            background-color: #161b22;
            color: #f1c40f;
            transform: translateX(24px);
        }

        body.dark-mode .theme-switch .slider::before {
            content: "üåô";
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                padding: 1rem;
                /* Reduced overall padding for smaller screens */
            }

            .page-layout-container {
                flex-direction: column;
                /* Stack menu and content vertically */
                gap: 1rem;
                /* max-width and margin:auto still apply, centering the column */
            }

            #side-menu {
                width: 100%;
                position: static;
                top: auto;
                height: auto;
                max-height: 300px;
            }

            .theme-switch {
                top: 0.5rem;
                right: 0.5rem;
            }
        }
    </style>
</head>

<body>

    <div class="theme-switch" onclick="toggleTheme()">
        <div class="slider"></div>
    </div>

    <div class="page-layout-container">
        <nav id="side-menu">
            <h2>Contents</h2>
            <ul id="menu-links">
                <!-- Links will be dynamically inserted -->
            </ul>
        </nav>

        <div class="content-wrapper">
            <div class="markdown-body">
                <h1
                id="your-guide-to-using-digital-research-alliance-of-canada-hpc-clusters"><strong>Your
                Guide to Using Digital Research Alliance of Canada HPC
                Clusters</strong></h1>
                <p>Welcome! This guide will walk you through setting up
                your account and running your first computational tasks
                (we call them ‚Äújobs‚Äù) on the powerful High-Performance
                Computing (HPC) clusters provided by the Digital
                Research Alliance of Canada (the Alliance). Think of
                these HPC clusters as very powerful remote computers
                that can handle much larger calculations than your
                personal laptop or desktop.</p>
                <p><strong>Stuck? Need help?</strong> Ask on
                Discord!</p>
                <hr />
                <h2 id="quick-workflow-overview"><strong>Quick Workflow
                Overview</strong></h2>
                <p>Using the HPC clusters generally follows these
                steps:</p>
                <ol type="1">
                <li><strong>Account Setup:</strong> Create an Alliance
                account &amp; set up 2FA.</li>
                <li><strong>Connect:</strong> Use SSH to log in to a
                cluster.</li>
                <li><strong>Prepare Job:</strong>
                <ul>
                <li>Write a job script (<code>.sh</code> file) with
                instructions for the cluster.</li>
                <li>Prepare your code and data.</li>
                </ul></li>
                <li><strong>Transfer Files:</strong> Copy your script,
                code, and data to the cluster.</li>
                <li><strong>Manage Software/Dependencies:</strong>
                Ensure any needed software is available/loaded on the
                cluster.</li>
                <li><strong>Submit Job:</strong> Use <code>sbatch</code>
                to send your job script to the SLURM scheduler.</li>
                <li><strong>Monitor:</strong> Check your job‚Äôs status
                using <code>squeue</code>, <code>seff</code>, etc.</li>
                <li><strong>Retrieve Results:</strong> Download output
                files back to your local computer.</li>
                </ol>
                <hr />
                <h2
                id="i.-getting-set-up-account-and-connection"><strong>I.
                Getting Set Up: Account and Connection</strong></h2>
                <p>First, you‚Äôll need an account and a way to securely
                connect to the HPC clusters.</p>
                <h3 id="create-an-alliance-account">1. <strong>Create an
                Alliance Account</strong></h3>
                <ul>
                <li>Go to the <a
                href="https://ccdb.alliancecan.ca/account_application">account
                application page</a>.</li>
                <li>Use your <strong>University of Calgary</strong> or
                <strong>University of Toronto email address</strong>
                (e.g., <code>your.name@ucalgary.ca</code> or
                <code>your.name@mail.utoronto.ca</code>).</li>
                <li>In the ‚ÄòSponsor‚Äô field, enter the PI code Viki
                provided: <code>vdr-502-05</code>.</li>
                <li>Viki will approve your application, then Alliance
                staff will validate it. You‚Äôll receive emails updating
                you on the status.</li>
                </ul>
                <h3 id="enable-two-factor-authentication-2fa">2.
                <strong>Enable Two-Factor Authentication
                (2FA)</strong></h3>
                <ul>
                <li><strong>Security is crucial!</strong> Set up Duo
                Mobile for 2FA by following the instructions <a
                href="https://ccdb.alliancecan.ca/multi_factor_authentications">here</a>.
                This adds an extra security layer to your login.</li>
                </ul>
                <h3 id="confirm-cluster-access-choose-a-cluster">3.
                <strong>Confirm Cluster Access &amp; Choose a
                Cluster</strong></h3>
                <ul>
                <li>Once active, see your accessible resources <a
                href="https://ccdb.alliancecan.ca/me/allocations">here</a>.</li>
                <li><strong>Recommended General-Purpose
                Clusters:</strong>
                <ul>
                <li><a
                href="https://docs.alliancecan.ca/wiki/Narval">Narval</a></li>
                <li><a
                href="https://docs.alliancecan.ca/wiki/B%C3%A9luga">Beluga</a></li>
                <li><a
                href="https://docs.alliancecan.ca/wiki/Cedar">Cedar</a></li>
                </ul></li>
                <li><strong>Specialized Clusters &amp; Notes:</strong>
                <ul>
                <li><strong>Niagara:</strong> <a
                href="https://docs.alliancecan.ca/wiki/Niagara">Niagara</a>
                is for very large, specialized tasks. Apply separately
                <a
                href="https://ccdb.alliancecan.ca/services/opt_in">here</a>
                if needed. Niagara offers a user-friendly web portal:
                ‚Äò<a
                href="https://ondemand.scinet.utoronto.ca/pun/sys/dashboard/">OnDemand</a>‚Äô.</li>
                <li><strong>Nibi (Priority Access):</strong> For
                specific projects, you might use the
                <code>rrg-vikikrpd</code> account on the new <a
                href="https://docs.alliancecan.ca/wiki/Nibi">Nibi</a>
                cluster for priority access.</li>
                <li><strong>Retired (Do Not Use):</strong> <a
                href="https://docs.alliancecan.ca/wiki/Graham">Graham</a>
                is being shut down.</li>
                </ul></li>
                <li><strong>üí° Always Check Status:</strong> Before
                starting, check the <a
                href="https://status.alliancecan.ca/">Alliance status
                page</a> for maintenance or issues.</li>
                </ul>
                <h3
                id="connect-to-the-cluster-using-ssh-your-gateway-to-the-hpc">4.
                <strong>Connect to the Cluster using SSH (Your Gateway
                to the HPC)</strong></h3>
                <p>SSH (Secure Shell) is how you‚Äôll log in. You connect
                to a ‚Äúlogin node,‚Äù which is like the cluster‚Äôs front
                door.</p>
                <blockquote>
                <p><strong>‚ö†Ô∏è IMPORTANT: Login Node
                Etiquette</strong></p>
                <p>Login nodes are for managing files, editing scripts,
                and submitting jobs. <strong>Do NOT run computationally
                intensive tasks directly on login nodes.</strong> This
                can slow down the system for everyone. Heavy
                computations must be run as jobs submitted to the
                scheduler.</p>
                </blockquote>
                <p><strong>üíª Local Computer Action / üåê HPC Cluster
                Action Legend:</strong> * <strong>üíª LOCAL:</strong>
                Commands you run on your personal computer‚Äôs terminal. *
                <strong>üåê HPC:</strong> Commands you run <em>after</em>
                you‚Äôve SSH‚Äôd into the cluster.</p>
                <blockquote>
                <p><strong>üí° TIP: Use Two Terminal Windows for an
                Easier Workflow</strong></p>
                <p>To avoid constantly logging in/out of the HPC, open
                <strong>two terminal windows</strong> on your personal
                computer:<br />
                1. <strong>One terminal for your üíª LOCAL
                computer:</strong> For commands like
                <code>ssh-keygen</code> (for SSH keys) or
                <code>scp</code> (for file transfers).<br />
                2. <strong>One terminal for the üåê HPC
                connection:</strong> You‚Äôll use this to <code>ssh</code>
                into the HPC. Once connected, this terminal
                <em>becomes</em> your window into the HPC.</p>
                </blockquote>
                <ul>
                <li><strong>Connecting via SSH:</strong> Find the
                hostname for your chosen cluster (e.g., from links in
                Step 3). For Narval:
                <ul>
                <li>üíª <strong>In one of your local terminal windows
                (this will become your HPC terminal):</strong>
                <code>bash     ssh &lt;your_alliance_username&gt;@narval.alliancecan.ca</code>
                (Replace <code>&lt;your_alliance_username&gt;</code>
                with your username.)</li>
                <li>You‚Äôll be prompted for your password and then your
                Duo 2FA code.</li>
                </ul></li>
                <li><strong>Make Logins Easier (Recommended): Set up SSH
                Keys</strong> SSH keys let you log in without typing
                your password (you‚Äôll still need Duo 2FA).
                <ol type="1">
                <li><strong>Generate Key Pair (üíª LOCAL):</strong>
                <ul>
                <li>On your <strong>local computer‚Äôs
                terminal</strong>:</li>
                <li>Follow the <a
                href="https://docs.alliancecan.ca/wiki/Generating_SSH_keys_in_Windows">Windows
                Guide</a> or <a
                href="https://docs.alliancecan.ca/wiki/Using_SSH_keys_in_Linux">Linux/macOS/WSL
                Guide</a>.</li>
                <li>This usually involves
                <code>ssh-keygen -t ed25519</code>.</li>
                </ul></li>
                <li><strong>Copy Public Key Content (üíª LOCAL):</strong>
                <ul>
                <li>Locate your <strong>public key</strong> file (e.g.,
                <code>id_ed25519.pub</code>).</li>
                <li>Copy its entire content.</li>
                </ul></li>
                <li><strong>Add Public Key to CCDB:</strong>
                <ul>
                <li>Paste the copied public key into the <a
                href="https://ccdb.alliancecan.ca/ssh_authorized_keys">SSH
                Authorized Keys section</a> on the CCDB website. This
                registers your key with all Alliance clusters.</li>
                </ul></li>
                </ol></li>
                </ul>
                <h3
                id="essential-linux-commands-quick-reference"><strong>Essential
                Linux Commands (Quick Reference)</strong></h3>
                <p>Once logged into the HPC via SSH (üåê <strong>HPC
                Terminal</strong>), you‚Äôll use these Linux commands:</p>
                <ul>
                <li><code>pwd</code>: Show current directory.</li>
                <li><code>ls</code>: List files/directories.
                (<code>ls -l</code> for details, <code>ls -a</code> for
                hidden files).</li>
                <li><code>cd &lt;directory_name&gt;</code>: Change
                directory.
                <ul>
                <li><code>cd ..</code>: Move up one level.</li>
                <li><code>cd ~</code> or <code>cd</code>: Go to your
                home directory.</li>
                </ul></li>
                <li><code>mkdir &lt;directory_name&gt;</code>: Create a
                new directory.</li>
                <li><code>cp &lt;source&gt; &lt;destination&gt;</code>:
                Copy file/directory.</li>
                <li><code>mv &lt;source&gt; &lt;destination&gt;</code>:
                Move or rename file/directory.</li>
                <li><code>rm &lt;file_name&gt;</code>: Delete a file.
                <strong>‚ö†Ô∏è CAUTION: No undo!</strong></li>
                <li><code>cat &lt;file_name&gt;</code>: Display file
                content.</li>
                <li><code>less &lt;file_name&gt;</code>: View file page
                by page (<code>q</code> to quit).</li>
                <li><code>nano &lt;file_name&gt;</code>: Edit file in a
                beginner-friendly terminal editor.
                <ul>
                <li><code>Ctrl + O</code> to Save, <code>Ctrl + X</code>
                to Exit.</li>
                <li><code>Ctrl + K</code> to Cut line,
                <code>Ctrl + U</code> to Paste line.</li>
                </ul></li>
                <li><code>watch &lt;command&gt;</code>: Run a command
                repeatedly and display the output (e.g.,
                <code>watch sq</code> to monitor job status).</li>
                </ul>
                <blockquote>
                <p><strong>üí° Windows Users:</strong></p>
                <ul>
                <li>Consider using <strong><a
                href="https://learn.microsoft.com/en-us/windows/wsl/install">WSL2</a></strong>
                for a Linux-like environment.</li>
                <li>In VS Code, set ‚ÄúEnd of Line Sequence‚Äù to
                <code>LF</code>.</li>
                <li>If you see
                <code>Batch script contains DOS line breaks (\r\n)</code>,
                fix with <code>dos2unix your_script.sub</code> (üåê
                <strong>HPC Terminal</strong>).</li>
                </ul>
                </blockquote>
                <hr />
                <h2
                id="ii.-preparing-and-submitting-your-computational-job"><strong>II.
                Preparing and Submitting Your Computational
                Job</strong></h2>
                <p>A ‚Äújob‚Äù is a script that tells the HPC what
                calculations to perform.</p>
                <h3 id="understand-job-scripts">5. <strong>Understand
                Job Scripts</strong></h3>
                <ul>
                <li>You write instructions in a text file called a ‚Äújob
                script‚Äù (e.g., <code>my_job.sh</code>,
                <code>my_job.sub</code>).</li>
                <li>Typically written in Bash (a command-line language)
                <strong>on your local computer</strong> using a text
                editor.</li>
                <li><strong><code>#SBATCH</code> directives:</strong>
                Lines starting with <code>#SBATCH</code> are special
                instructions for <strong>SLURM</strong> (the workload
                manager). They specify resources like CPU cores, memory,
                and time.</li>
                <li>The rest of the script contains commands to run your
                program (e.g., load software, execute Python code).</li>
                </ul>
                <h3 id="crafting-your-job-script-example-my_job.sh">6.
                <strong>Crafting Your Job Script (Example:
                <code>my_job.sh</code>)</strong></h3>
                <blockquote>
                <p><strong>üí° Estimating Resources (<code>-n</code>,
                <code>--mem-per-cpu</code>, <code>--time</code>) is
                Key!</strong></p>
                <ul>
                <li><strong>Too much:</strong> Your job might wait
                longer in the queue or waste resources.</li>
                <li><strong>Too little:</strong> Your job might
                fail.</li>
                <li>Start with reasonable estimates and adjust based on
                job performance (use <code>seff</code> command
                later).</li>
                </ul>
                </blockquote>
                <blockquote>
                <p><strong>‚ùóIMPORTANT: File Paths in
                Scripts</strong></p>
                <ul>
                <li>Ensure any directories specified for output/error
                files (e.g., <code>/path/to/your/project/logs/</code>)
                <strong>exist on the HPC</strong> <em>before</em>
                submitting.</li>
                <li>You can create them in your job script:
                <code>mkdir -p /path/to/your/project/logs</code> (this
                runs on the HPC).</li>
                <li>Using absolute paths (starting with <code>/</code>)
                is safest. Use <code>pwd</code> (üåê <strong>HPC
                Terminal</strong>) to find absolute paths.</li>
                </ul>
                </blockquote>
                <div class="sourceCode" id="cb1"><pre
                class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --account=def-vikikrpd  # Your group&#39;s allocation (check CCDB for yours)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -N 1                    # Number of nodes (computers) (usually 1)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -n 4                    # Number of CPU cores (processors)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem-per-cpu=512M      # Memory per CPU core (e.g., 512M, 1G, 4G)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                                <span class="co"># (Don&#39;t use this specific option on Niagara)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=00-00:20:00      # Max runtime (Days-HH:MM:SS) - JOB KILLED AFTER THIS!</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --job-name=MyExampleJob # Descriptive job name</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=/path/to/your/project/logs/%x-%j.out  # Standard output file (%x=jobname, %j=jobid)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                                                      <span class="co"># Ensure &#39;/path/to/your/project/logs&#39; exists on HPC!</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --error=/path/to/your/project/logs/%x-%j.err   # Standard error file</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                                                      <span class="co"># Ensure &#39;/path/to/your/project/logs&#39; exists on HPC!</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mail-user=your_email@example.com # Optional: Email for job status</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mail-type=FAIL,INVALID_DEPEND,REQUEUE,STAGE_OUT #,</span><span class="re">END</span><span class="co"> # Email events</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Job started on </span><span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span><span class="st"> at: </span><span class="va">$(</span><span class="fu">date</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Job ID: </span><span class="va">$SLURM_JOB_ID</span><span class="st">&quot;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;My working directory on HPC is: </span><span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span><span class="st">&quot;</span> <span class="co"># This will be your submission directory</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;--- Setting up software (on HPC) ---&quot;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load python/3.10 <span class="co"># Load pre-installed software</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a temporary, private workspace for this job on the HPC</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># $SLURM_TMPDIR is a special fast, temporary directory for your job on the HPC</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Using it is often faster for installing packages and running code</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="ex">virtualenv</span> <span class="at">--no-download</span> <span class="st">&quot;</span><span class="va">$SLURM_TMPDIR</span><span class="st">/env&quot;</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> <span class="st">&quot;</span><span class="va">$SLURM_TMPDIR</span><span class="st">/env/bin/activate&quot;</span> <span class="co"># Activate virtual environment</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;--- Installing Python packages (if any) (on HPC) ---&quot;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Using --no-index tells pip not to look online, good if pre-downloaded wheels are available</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># See: https://docs.alliancecan.ca/wiki/Python#Installing_packages_in_a_virtual_environment</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">--no-index</span> <span class="at">--upgrade</span> pip</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install numpy <span class="at">--no-index</span> <span class="co"># Example</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># For many packages, use a requirements.txt file:</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># pip install --no-index -r /path/to/your/project/requirements.txt # Ensure path is correct on HPC</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;--- Running my Python script (on HPC) ---&quot;</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace with your actual command. Ensure paths to script/data are correct on HPC.</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> /path/to/your/project/src/my_script.py <span class="at">--input</span> /path/to/data <span class="at">--output</span> <span class="st">&quot;</span><span class="va">$SLURM_TMPDIR</span><span class="st">/results.csv&quot;</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="va">SCRIPT_EXIT_CODE</span><span class="op">=</span><span class="va">$?</span> <span class="co"># Save script&#39;s exit code</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;--- Python script finished with exit code </span><span class="va">$SCRIPT_EXIT_CODE</span><span class="st"> (on HPC) ---&quot;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co"># If your script created important files in $SLURM_TMPDIR, copy them back to persistent storage</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># cp &quot;$SLURM_TMPDIR/results.csv&quot; /path/to/your/project/results/my_job_results.csv</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Job finished at: </span><span class="va">$(</span><span class="fu">date</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span> <span class="va">$SCRIPT_EXIT_CODE</span> <span class="co"># Important: Exit with your script&#39;s exit code</span></span></code></pre></div>
                <blockquote>
                <p><strong>‚ö†Ô∏è WARNING: Adapt This Example
                Script!</strong></p>
                <p>You <strong>must</strong> modify:</p>
                <ul>
                <li><code>#SBATCH --account=...</code> to your specific
                allocation.</li>
                <li><code>#SBATCH --output=...</code> and
                <code>#SBATCH --error=...</code> to valid paths
                <strong>on the HPC</strong> within your accessible
                directories (e.g., in your <code>project</code> or
                <code>scratch</code> space). Use <code>pwd</code> (üåê
                <strong>HPC Terminal</strong>) to find these paths.</li>
                <li>The <code>python ...</code> command to point to your
                Python script and its arguments on the HPC. Python
                scripts don‚Äôt inherently use <code>--input</code> and
                <code>--output</code>; these are examples of how you
                might pass arguments to <em>your</em> script.</li>
                </ul>
                </blockquote>
                <h3 id="transfer-your-files-to-the-cluster">7.
                <strong>Transfer Your Files to the Cluster</strong></h3>
                <p>Get your job script, Python code, and input data
                ready on your local computer. Use <code>scp</code>
                (secure copy) or <code>rsync</code> (remote sync) to
                transfer them.</p>
                <ul>
                <li><p><strong>Commands are run on your üíª LOCAL
                computer‚Äôs terminal.</strong></p></li>
                <li><p>Transfer files to your <strong>home
                directory</strong> (<code>~</code>), <strong>project
                directory</strong>, or <strong>scratch
                directory</strong> on the HPC.</p></li>
                <li><p><strong>For very large files, use the cluster‚Äôs
                dedicated Data Transfer Node (DTN).</strong> Find its
                hostname in the cluster‚Äôs documentation (e.g.,
                <code>narval.alliancecan.ca</code>).</p>
                <ul>
                <li><p><strong>Using <code>scp</code> (üíª
                LOCAL):</strong></p>
                <div class="sourceCode" id="cb2"><pre
                class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy a single file (e.g., your job script)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># scp &lt;local_file_path&gt; &lt;username&gt;@&lt;cluster_login_or_dtn&gt;:&lt;path_on_HPC&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> my_job.sh your_username@narval.alliancecan.ca:~/my_project/</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy a whole directory recursively (-r)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> <span class="at">-r</span> local_code_folder your_username@narval.alliancecan.ca:~/my_project/</span></code></pre></div></li>
                <li><p><strong>Using <code>rsync</code> (often better
                for directories) (üíª LOCAL):</strong>
                <code>bash     # rsync -avz &lt;local_directory/&gt; &lt;username&gt;@&lt;cluster_login_or_dtn&gt;:&lt;path_on_HPC_directory/&gt;     # Trailing slashes are important!     rsync -avz --exclude='__pycache__/' --exclude='*.tmp' local_code_folder/ your_username@narval.alliancecan.ca:~/my_project/code_folder/</code></p></li>
                </ul></li>
                </ul>
                <blockquote>
                <p><strong>üí° TIP: Compress Large
                Transfers!</strong></p>
                <p>For many files or large directories, compress them
                into a <code>.tar.gz</code> archive (‚Äútarball‚Äù) locally,
                transfer the single archive, then uncompress it on the
                cluster.</p>
                <ol type="1">
                <li><strong>Create archive (üíª LOCAL):</strong>
                <code>bash     tar -czf project_archive.tar.gz local_directory_to_compress/</code></li>
                <li><strong>Transfer archive (üíª LOCAL):</strong>
                <code>bash     scp project_archive.tar.gz your_username@narval.alliancecan.ca:~/</code></li>
                <li><strong>Decompress archive (üåê HPC - after SSHing
                in):</strong>
                <code>bash     cd ~  # Navigate to where you put the archive on HPC     tar -xzf project_archive.tar.gz</code></li>
                </ol>
                </blockquote>
                <blockquote>
                <p><strong>üìÅ Where to Store Files on the
                HPC:</strong></p>
                <ul>
                <li><strong>Home (<code>~</code> or
                <code>$HOME</code>):</strong> For scripts, small
                software, config files. Limited space. <strong>Do NOT
                run I/O-heavy jobs from here.</strong></li>
                <li><strong>Project (<code>$PROJECT</code> or
                <code>/project/def-&lt;account&gt;</code>):</strong> For
                larger datasets, shared files, persistent research data.
                Preferred for most research data.</li>
                <li><strong>Scratch (<code>$SCRATCH</code> or
                <code>/scratch/&lt;username&gt;</code>):</strong> For
                temporary, large files generated during computations,
                and for running jobs. ‚ö†Ô∏è <strong>Files may be
                auto-deleted!</strong> Check the <a
                href="https://docs.alliancecan.ca/wiki/Scratch_purging_policy">scratch
                purging policy</a>.</li>
                <li>üåê <strong>Check your disk space:</strong> Use the
                <code>quota</code> command on the HPC.</li>
                </ul>
                </blockquote>
                <blockquote>
                <p><strong>‚ö†Ô∏è Where to Submit Jobs From (Working
                Directory):</strong></p>
                <ul>
                <li><strong>Recommended:</strong> Submit and run jobs
                from your <code>scratch/</code> or <code>project/</code>
                directories.</li>
                <li><strong>Avoid:</strong> Running jobs that heavily
                use your home directory (<code>~</code>) for
                input/output. This can impact the cluster‚Äôs file system
                performance and may lead to account suspension.</li>
                </ul>
                </blockquote>
                <h3
                id="manage-dependencies-your-job-needs-on-the-hpc">8.
                <strong>Manage Dependencies Your Job Needs (on the
                HPC)</strong></h3>
                <p>Ensure the software your job requires is accessible
                within the job‚Äôs environment on the HPC.</p>
                <ul>
                <li><strong>Modules (Easiest for Common
                Software):</strong>
                <ul>
                <li>Many packages are pre-installed. Load them using
                <code>module</code> (üåê <strong>HPC Terminal</strong> or
                in your job script).
                <ul>
                <li><code>module avail &lt;software_name&gt;</code>
                (e.g., <code>module avail python</code>): Search for
                software.</li>
                <li><code>module load &lt;module_name/version&gt;</code>
                (e.g., <code>module load python/3.10</code>): Make
                software usable.</li>
                </ul></li>
                </ul></li>
                <li><strong>Python Virtual Environments
                (<code>venv</code>): Recommended for Python!</strong>
                <ul>
                <li>Creates an isolated environment for your Python
                packages on the HPC.</li>
                <li>Usually created/activated inside your job script
                (see example), often in <code>$SLURM_TMPDIR</code> for
                better I/O performance.</li>
                <li>Use <code>pip install</code> to add packages.</li>
                <li><code>--no-index</code> with <code>pip</code> is
                good practice on clusters if pre-downloaded package
                files (‚Äúwheels‚Äù) are provided, avoiding unnecessary
                internet access.</li>
                </ul></li>
                <li><strong>Apptainer for Complex/Reproducible
                Environments:</strong>
                <ul>
                <li>Ensures your software environment is
                consistent.</li>
                </ul>
                <ol type="1">
                <li><strong>Build Container Image (üíª LOCAL):</strong>
                <ul>
                <li>Install <a
                href="https://apptainer.org/docs/admin/main/installation.html#install-ubuntu-packages">Apptainer</a>
                locally.</li>
                <li>Create a container image (<code>.sif</code> file),
                often from a Dockerfile: <a
                href="https://docs.alliancecan.ca/wiki/Apptainer#Creating_an_Apptainer_container_from_a_Dockerfile">Create
                from Dockerfile</a>.</li>
                </ul></li>
                <li><strong>Transfer <code>.sif</code> File (üíª
                LOCAL):</strong>
                <ul>
                <li>Use <code>scp</code> or <code>rsync</code> to copy
                the <code>.sif</code> file to the HPC.</li>
                </ul></li>
                <li><strong>Run Program in Container (üåê HPC - in job
                script):</strong>
                <ul>
                <li>See <a
                href="https://docs.alliancecan.ca/wiki/Apptainer#Running_programs_within_a_container">Running
                programs in a container</a>.</li>
                </ul></li>
                </ol></li>
                </ul>
                <h3 id="submit-your-job-to-slurm-on-the-hpc">9.
                <strong>Submit Your Job to SLURM (on the
                HPC)</strong></h3>
                <ul>
                <li>Make sure you are logged into the HPC cluster (üåê
                <strong>HPC Terminal</strong>).</li>
                <li><code>cd</code> to the directory on the HPC
                containing your job script.</li>
                <li><strong>Submit the job:</strong>
                <ul>
                <li>üåê <strong>On the HPC cluster:</strong>
                <code>bash     sbatch your_job_script.sh</code></li>
                <li>SLURM will reply with a Job ID (e.g.,
                <code>Submitted batch job 1234567</code>). <strong>Note
                this ID!</strong></li>
                </ul></li>
                <li><strong>Submitting Many Similar Jobs:</strong>
                <ul>
                <li>If you have multiple job scripts (e.g.,
                <code>job1.sh</code>, <code>job2.sh</code>, ‚Ä¶) on the
                HPC:</li>
                <li>üåê <strong>On the HPC cluster (CAREFUL: ensure this
                targets ONLY your job scripts):</strong>
                <code>bash     # Finds all .sh files in current HPC directory and runs sbatch on them     find . -maxdepth 1 -name "*.sh" -exec sbatch {} \;</code></li>
                </ul></li>
                </ul>
                <hr />
                <h2
                id="iii.-checking-on-your-job-and-getting-results"><strong>III.
                Checking on Your Job and Getting Results</strong></h2>
                <p>Your job waits in a queue, then runs. Here‚Äôs how to
                track it and get results.</p>
                <h3 id="monitor-your-jobs-on-the-hpc">10.
                <strong>Monitor Your Jobs (on the HPC)</strong></h3>
                <ul>
                <li>üåê <strong>Use these commands in your HPC
                terminal:</strong>
                <ul>
                <li><code>squeue -u &lt;your_username&gt;</code>: Shows
                your jobs (Running <code>R</code> or Pending
                <code>PD</code>) (Common alias: <code>sq</code>).</li>
                <li><code>scancel &lt;Job_ID&gt;</code>: Stops/cancels
                one of your jobs.</li>
                <li><code>seff &lt;Job_ID&gt;</code>: (For
                <em>completed</em> jobs) Shows CPU/memory efficiency.
                <strong>Crucial for adjusting <code>#SBATCH</code>
                requests!</strong></li>
                <li><code>sacct -j &lt;Job_ID&gt; --format=JobID,JobName,State,ExitCode,Elapsed,MaxRSS,AllocCPUS</code>:
                Detailed accounting for a job.</li>
                <li><code>quota</code>: Check your disk space
                usage.</li>
                </ul></li>
                </ul>
                <h3 id="retrieve-your-jobs-results">11. <strong>Retrieve
                Your Job‚Äôs Results</strong></h3>
                <ul>
                <li>Output files (and
                <code>.out</code>/<code>.err</code> files) will be in
                the HPC directories specified in your script.</li>
                <li><strong>Compress results before download if
                large/many:</strong>
                <ul>
                <li>üåê <strong>On the HPC cluster:</strong>
                <code>bash     # Navigate to the directory ABOVE your results folder on HPC     # tar -czf &lt;name_of_archive.tar.gz&gt; &lt;directory_to_archive/&gt;     tar -czf my_results_archive.tar.gz /path/to/your/results_directory/</code></li>
                </ul></li>
                <li><strong>Download files/archives (üíª LOCAL computer‚Äôs
                terminal):</strong>
                <ul>
                <li><p>Use <code>scp</code> or <code>rsync</code>. Use
                the cluster‚Äôs <strong>DTN</strong> for large
                files.</p></li>
                <li><p>üíª <strong>On your local computer‚Äôs
                terminal:</strong></p>
                <div class="sourceCode" id="cb3"><pre
                class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scp &lt;username&gt;@&lt;cluster_dtn_or_login_node&gt;:&lt;path_on_HPC_to_file&gt; &lt;local_destination_path&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> your_username@narval-dtn.alliancecan.ca:/path/on/cluster/to/my_results_archive.tar.gz .</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The &quot;.&quot; means download to your current local directory</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># If archived, extract locally:</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-xzf</span> my_results_archive.tar.gz</span></code></pre></div></li>
                </ul></li>
                </ul>
                <hr />
                <h2 id="iv.-where-to-learn-more"><strong>IV. Where to
                Learn More</strong></h2>
                <p>This guide covers the basics. Explore these resources
                for more depth:</p>
                <ul>
                <li><strong>Alliance Documentation Wiki:</strong> <a
                href="https://docs.alliancecan.ca/wiki/">https://docs.alliancecan.ca/wiki/</a>
                (<strong>Primary source!</strong>)</li>
                <li><strong>Running Jobs (More Details):</strong> <a
                href="https://docs.alliancecan.ca/wiki/Running_jobs">https://docs.alliancecan.ca/wiki/Running_jobs</a></li>
                <li><strong>SLURM <code>sbatch</code> Options:</strong>
                <a
                href="https://slurm.schedmd.com/sbatch.html">https://slurm.schedmd.com/sbatch.html</a>
                (Official, detailed list)</li>
                <li><strong>Specific Cluster Docs:</strong> (Links in <a
                href="#3-confirm-cluster-access--choose-a-cluster">Section
                I, Step 3</a>)</li>
                <li><strong>Google &amp; LLMs:</strong> Searching
                ‚ÄúDigital Research Alliance Canada <your_topic>‚Äù or
                ‚ÄúCompute Canada <your_topic>‚Äù (older name) often yields
                helpful wiki/forum results.</li>
                </ul>
                <p>Good luck, and happy computing!</p>
            </div>
        </div>
    </div>

    <script>
        // Theme settings
        const lightThemeUrl = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css';
        const darkThemeUrl = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css';
        const themeLink = document.getElementById('hljs-theme-link');

        function setTheme(isDark) {
            document.body.classList.toggle('dark-mode', isDark);
            themeLink.href = isDark ? darkThemeUrl : lightThemeUrl;
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            if (typeof handleScrollActiveSection === 'function') {
                setTimeout(handleScrollActiveSection, 0);
            }
        }

        function toggleTheme() {
            setTheme(!document.body.classList.contains('dark-mode'));
        }

        // TOC and Active Section
        let sectionElements = [];
        let menuLinks = {};
        const scrollHighlightOffset = 150; // Pixels from viewport top to consider section active

        function generateTableOfContents() {
            const contentSource = document.querySelector('.markdown-body');
            const menuUl = document.getElementById('menu-links');
            menuLinks = {};

            if (!contentSource || !menuUl) return;
            menuUl.innerHTML = '';

            const headings = contentSource.querySelectorAll('h1[id], h2[id], h3[id]');
            if (headings.length === 0) {
                const li = document.createElement('li');
                li.textContent = "No sections found.";
                li.style.padding = "0.4em 0.6em";
                menuUl.appendChild(li);
                return;
            }

            headings.forEach(heading => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = '#' + heading.id;
                a.textContent = heading.textContent.trim();

                const level = heading.tagName.substring(1);
                li.classList.add('toc-level-' + level);

                li.appendChild(a);
                menuUl.appendChild(li);
                menuLinks[heading.id] = a;
            });
        }

        function initActiveSectionHighlighting() {
            const contentSource = document.querySelector('.markdown-body');
            if (!contentSource) return;

            sectionElements = Array.from(contentSource.querySelectorAll('h1[id], h2[id], h3[id]'))
                .sort((a, b) => a.offsetTop - b.offsetTop);

            if (sectionElements.length > 0 && Object.keys(menuLinks).length > 0) {
                window.addEventListener('scroll', handleScrollActiveSection, { passive: true });
                handleScrollActiveSection(); // Initial check
            }
        }

        function handleScrollActiveSection() {
            if (sectionElements.length === 0 || Object.keys(menuLinks).length === 0) return;

            let currentSectionId = '';
            const scrollY = window.scrollY; // Use window.scrollY for consistency

            for (const section of sectionElements) {
                if (section.offsetTop <= scrollY + scrollHighlightOffset) {
                    currentSectionId = section.id;
                } else {
                    break;
                }
            }

            // Fallback if no section is above offset (e.g. top of page)
            if (!currentSectionId && sectionElements.length > 0) {
                // Check if first section is reasonably visible near top of viewport
                const firstSectionTop = sectionElements[0].getBoundingClientRect().top;
                if (firstSectionTop >= 0 && firstSectionTop < window.innerHeight * 0.75) {
                    currentSectionId = sectionElements[0].id;
                }
            }

            // At the very bottom of the page
            if ((window.innerHeight + Math.ceil(scrollY)) >= document.body.scrollHeight - 5) {
                if (sectionElements.length > 0) {
                    currentSectionId = sectionElements[sectionElements.length - 1].id;
                }
            }

            Object.values(menuLinks).forEach(link => link.classList.remove('active'));
            if (currentSectionId && menuLinks[currentSectionId]) {
                menuLinks[currentSectionId].classList.add('active');
            }
        }

        // Initial setup
        (function () {
            let isDarkMode = localStorage.getItem('theme') === 'dark' ||
                (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
            setTheme(isDarkMode);
            hljs.highlightAll();
            generateTableOfContents();
            initActiveSectionHighlighting();
        })();
    </script>

</body>

</html>